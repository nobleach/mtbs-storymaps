/*! instructure-canvas - v0.0.1 - 2014-04-24 */
var margin={top:10,right:20,bottom:30,left:80},w=380-margin.left-margin.right,h=150-margin.top-margin.bottom,brashDirty,feature,map=L.map("map",{center:[30.4486736,-127.88085937],zoom:3}).addLayer(new L.TileLayer("http://{s}.tiles.mapbox.com/v3/examples.map-vyofok3q/{z}/{x}/{y}.png")),svg=d3.select(map.getPanes().overlayPane).append("svg"),g=svg.append("g").attr("class","leaflet-zoom-hide"),fireScale=d3.scale.pow().exponent(.5).domain([0,1e3,1e4,56e3,23e6]),colorScale=d3.scale.linear().domain([0,100,1e3,1e4,1e5]),yearHist=d3.select("#yearChart").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom}),areaHist=d3.select("#areaChart").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom});d3.json("js/mtbs-fires.json",function(a){function b(a){feature=g.selectAll(".path").data(a),feature.exit().remove(),feature.enter().append("path").attr("class","path"),feature.style("fill",function(a){return colorScale(a.area)}),feature.style("fill",function(a){return colorScale(a.area)}).attr("d",i)}function c(){var a=u.extent();startYear=Math.floor(a[0]),endYear=Math.floor(a[1]);var c=j.filter(function(a){return a.year>=startYear&&a.year<=endYear?a:void 0});b(c);var d;d=d3.select("fireBrush"===this.id?"#areaBrush":"#fireBrush"),d.transition().call(u.extent([startYear,endYear])).call(u.event)}function d(){var b=i.bounds(a),c=b[0],d=b[1];svg.attr("width",d[0]-c[0]).attr("height",d[1]-c[1]).style("left",c[0]+"px").style("top",c[1]+"px"),g.attr("transform","translate("+-c[0]+","+-c[1]+")"),feature.attr("d",i)}function e(a,b){var c=map.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x,c.y)}var f=d3.geo.transform({point:e}),i=d3.geo.path().projection(f),j=[],k=[],l={};a.features.forEach(function(a){a.name=a.properties.FIRENAME,a.year=+a.properties.FIRE_YEAR,a.area=+a.properties.R_ACRES,j.push(a);var b=a.year+"";l.hasOwnProperty(b)||(l[b]={area:0,numFires:0}),l[b].area+=a.area,l[b].numFires+=1});for(var m in l){var n={};n.year=m,n.area=l[m].area,n.numFires=l[m].numFires,k.push(n)}var o=d3.scale.linear().domain([0,d3.max(k,function(a){return a.numFires})]).range([h,0]),p=d3.scale.linear().domain([0,d3.max(k,function(a){return a.area})]).range([h,0]),q=d3.scale.linear().domain(d3.extent(k,function(a){return a.year})).range([0,w]),r=d3.svg.axis().scale(p).orient("left"),s=d3.svg.axis().scale(o).orient("left"),t=d3.svg.axis().scale(q).orient("bottom").ticks(5).tickFormat(d3.format("")),u=d3.svg.brush().x(q).extent([1984,2013]).on("brushend",c);colorScale.range(["#FFFF66","#FFFF00","#E68000","#D94000","#CC0000"]),map.on("viewreset",d),b(j),d(),yearHist.append("g").attr({"class":"axis",transform:"translate("+[margin.left,0]+")"}).call(s),yearHist.append("g").attr({"class":"axis",transform:"translate("+[margin.left,h]+")"}).call(t),yearHist.selectAll("rect").data(k).enter().append("rect").attr({x:function(a){return w+margin.left-q(a.year)},y:function(a){return h-o(a.numFires)},width:9,height:function(a){return o(a.numFires)},fill:"orange"});var v=yearHist.append("g").attr({"class":"brush",id:"fireBrush",transform:"translate("+[margin.left,0]+")"}).call(u);v.selectAll("rect").attr("height",h),areaHist.append("g").attr({"class":"axis",transform:"translate("+[margin.left,0]+")"}).call(r),areaHist.append("g").attr({"class":"axis",transform:"translate("+[margin.left,h]+")"}).call(t),areaHist.selectAll("rect").data(k).enter().append("rect").attr({x:function(a){return w+margin.left-q(a.year)},y:function(a){return h-p(a.area)},width:9,height:function(a){return p(a.area)},fill:"orange"});var x=areaHist.append("g").attr({"class":"brush",id:"areaBrush",transform:"translate("+[margin.left,0]+")"}).call(u);x.selectAll("rect").attr("height",h)});
//# sourceMappingURL=main.map